\documentclass[12pt,a4paper,twoside]{article}
\usepackage[utf8]{inputenc}  % pravilno razpoznavanje unicode znakov

\usepackage[slovene]{babel}  % slovenščina
\usepackage[T1]{fontenc}     % naprednejše kodiranje fonta
\usepackage{amsmath,amssymb,amsfonts,amsthm} % matematični paketi
\usepackage[dvipsnames,usenames]{color} % barve
\usepackage{graphicx}     % za slike
\usepackage{emptypage}    % prazne strani so neoštevilčene, ampak so štete
\usepackage{tikz}

% oblika strani
\usepackage[
  top=3cm,
  bottom=3cm,
  inner=3.5cm,      % margini za dvostransko tiskanje
  outer=2.5cm,
  footskip=40pt     % pozicija številke strani
]{geometry}

% VEČ ZANIMIVIH PAKETOV
% \usepackage{array}      % več možnosti za tabele
% \usepackage[list=true,listformat=simple]{subcaption}  % več kot ena slika na figure, omogoči slika 1a, slika 1b
% \usepackage[all]{xy}    % diagrami
% \usepackage{doi}        % za clickable DOI entrye v bibliografiji
% \usepackage{enumerate}     % več možnosti za sezname

% Za barvanje source kode
% \usepackage{minted}
% \renewcommand\listingscaption{Program}

% Za pisanje psevdokode
% \usepackage{algpseudocode}  % za psevdokodo
% \usepackage{algorithm}
% \floatname{algorithm}{Algoritem}
% \renewcommand{\listalgorithmname}{Kazalo algoritmov}

% DRUGI TVOJI PAKETI:
\usepackage[numbered,framed]{matlab-prettifier}

\let\ph\mlplaceholder % shorter macro
\lstMakeShortInline"

\lstset{
  style              = Matlab-editor,
  basicstyle         = \mlttfamily,
  escapechar         = ",
  mlshowsectionrules = true,
}

\setlength{\overfullrule}{50pt} % označi predlogo vrstico
\pagestyle{plain}               % samo številka strani na dnu, nobene glave / noge

% ukazi za matematična okolja
\theoremstyle{definition} % tekst napisan pokončno
\newtheorem{definicija}{Definicija}[section]
\newtheorem{primer}[definicija]{Primer}
\newtheorem{opomba}[definicija]{Opomba}
\newtheorem{aksiom}{Aksiom}

\theoremstyle{plain} % tekst napisan poševno
\newtheorem{lema}[definicija]{Lema}
\newtheorem{izrek}[definicija]{Izrek}
\newtheorem{trditev}[definicija]{Trditev}
\newtheorem{posledica}[definicija]{Posledica}

\numberwithin{equation}{section}  % števec za enačbe zgleda kot (2.7) in se resetira v vsakem poglavju

% Matematični ukazi
\newcommand{\R}{\mathbb R}
\newcommand{\N}{\mathbb N}
\newcommand{\Z}{\mathbb Z}
%\renewcommand{\C}{\mathbb C}
\newcommand{\Q}{\mathbb Q}
\renewcommand{\H}{\mathbb H}

% \DeclareMathOperator{\tr}{tr}  % morda potrebuješ operator za sled ali kaj drugega?

% bold matematika znotraj \textbf{ }, tudi v naslovih, kot \omega spodaj
%\makeatletter \g@addto@macro\bfseries{\boldmath} \makeatother
%
%% Poimenuj kazalo slik kot ``Kazalo slik'' in ne ``Slike''
%\addto\captionsslovene{
%  \renewcommand{\listfigurename}{Kazalo slik}%
%}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%           DOCUMENT           %%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

\thispagestyle{empty} % ampak na prvi strani ni številke



\begin{titlepage}\centering
\noindent{\large
Univerza v Ljubljani\\[1mm]
Fakulteta za matematiko in fiziko\\[5mm]}
\vspace*{\fill}
{\LARGE Geometrijsko zvezna gibanja togih teles} \\[1cm]
\large Matic Oskar Hajšen  in  Eva Zmazek
\vspace*{\fill}
\vfill
\noindent{\large Ljubljana, 2019}
\end{titlepage}

\cleardoublepage


\section{Uvod}

\tableofcontents

\lstlistoflistings

\subsection{Definicija}

Imamo $2$ koordinatna sistema v $\R^3$:
\begin{itemize}
\item fiksen koordinatni sistem $E^3$
\item gibajoč se koordinatni sistem $\hat{E}^3$
\end{itemize}
Točke lahko predstavimo v enem ali drugem.\\

\noindent Označimp s $\underline{p}$ točko glede na fiksen koordinatni sistem $E^3$, s $\underline{\hat{p}}$ pa glede na $\hat{E}^3$. Potrebujemo koordinatno transformacijo
$$\hat{E}^3 \to E^3$$
$$\underline{\hat{p}} \mapsto \underline{p} = \underline{c} + R \underline{\hat{p}}$$

\noindent $\underline{c}$ predstavlja položaj izhodišča koordinatnega sistema $\hat{E}^3$ v koordinatni sistem $E^3$, $R$ pa je \textbf{rotacijska matrika}, ki opisuje rotacijo gibajočega se koordinatnega sistema. \\

\noindent Kadar je $\underline{c} = \underline{c}(t)$ in $R=R(t)$, govorimo o gibanju togega telesa:
$$\hat{E}^3 \times I \to E^3$$
$$(\underline{\hat{p}},t) \mapsto \underline{c}(t) + R(t) \underline{\hat{p}} =: \underline{p}(t)$$
$\underline{p}(t)$ je trajektorija točke $\underline{\hat{p}}$ \\

\noindent Če je $\underline{c}(t) = (0,0,0)$, potem trajektorija poljubne točke $\underline{\hat{p}}$ leži na sferi z radijem $||\underline{\hat{p}}||$. \\

\noindent Rotacijski del gibanja $R(t)$ opisuje gibanje po enotski sferi, zato se imenuje tudi \textbf{sferični del gibanja togega telesa}. Problem je konstrukcija matrike $R$, ki mora biti ortogonalna. ($R R^T = R^T R = I$, $\det R = 1$). \\

\noindent Pri opisovanju rotacij si lahko pomagamo s \textbf{kvaternioni}. Prostor kvaternionov $\H$ je $4$-dimenzionalni vektorski prostor s standardno bazo
$$ \underline{1} = (1, (0,0,0)^T) $$
$$ \underline{i} = (0,(1,0,0)^T) $$
$$ \underline{j} = (0,(0,1,0)^T) $$
$$ \underline{k} = (0,(0,0,1)^T) $$

\noindent Vsak kvaternion $\mathcal{A}$ lahko zapišemo kot:
$$\mathcal{A} = (a_0,\underline{a}),~ a_0 \in \R \text{ skalarni del },~ \underline{a} = (a_1,a_2,a_3)^T \text{ vektorski del}$$

$$\mathcal{A} + \mathcal{B} = (a_0,\underline{a}) +(b_0,\underline{b}) = (a_0 + b_0,\underline{a} + \underline{b})$$
$$\mathcal{A} \cdot \mathcal{B}  = (a_0 \cdot b_0 - \underline{a} \cdot \underline{b}, a_0 \underline{b} + b_0 \underline{a} + \underline{a} \times \underline{b})$$

\begin{definicija}
\label{definicijarotacije}
Preslikava $\chi : \H \backslash \{0\} \to SO_3$ oblike

$$Q  \mapsto \frac{1}{q_0^2 + q_1^2 + q_2^2 + q_3^2}
\left[
\begin{tabular}{c c c}
$q_0^2 + q_1^2 - q_2^2 - q_3^2$ & $2(q_1 q_2 - q_0 q_3)$ & $2(q_1 q_3 + q_0 q_2)$ \\
& & \\
$2(q_1 q_2 + q_0 q_3)$ & $q_0^2 - q_1^2 + q_2^2 - q_3^2$ & $2(q_2 q_3 - q_0 q_1)$ \\
& & \\
$2(q_1 q_3 - q_0 q_2)$ & $2(q_2 q_3 + q_0 q_2)$ & $q_0^2 - q_1^2 - q_2^2 + q_3^2$
\end{tabular}
\right]
$$

$$ Q = (q_0,(q_1,q_2,q_3)^T)$$
\\
se imenuje \textbf{kinematična preslikava}.
\end{definicija}

\noindent Matika $\chi(Q)$ je rotacijska matrika.

\noindent Velja pa tudi obratno. Vsako rotacijsko matriko $R$ lahko zapišemo v zgornji obliki, to je lahko jo preslikamo v dva \textbf{antipodna kvaterniona} oblike
$$\pm Q = \pm(q_0,(q_1,q_2,q_3)^T),$$
$$q_0^2 + q_1^2 + q_2^2 + q_3^2 = 1$$

\noindent \textbf{Kinematična preslikava} poda korespondenco med 3D rotacijami in parom antipodnih točk na 4D enotski sferi $S^3 \subseteq R^4$.

\noindent Z uporabo kinematične preslikave lahko za konstrukcijo sferičnih gibanj uporabimo Bezierjeve krivulje.

\noindent Izberemo kontrolne kvaternione $Q_0,Q_1,\dots,Q_n$
$$Q(t) = \sum\limits_{i=0}^{n} Q_i B_i^n(t)$$
$$\chi(Q(t)) = R(t)$$

\noindent Izberemo $\underline{c}(t) = \frac{w(t)}{||Q(t)||^2}$.

\section{Implementacija}

Ker si pri opisovanju rotacij pomagamo s kvaternioni, sva jih najprej prevedla iz seznama v vektorsko obliko:

\begin{lstlisting}
function Q = array2quat(a, b, c, d)
%input:
%a, b, c, d     komponente   
%output:
%Q              kvaternion

Q = [a, b, c, d];
end
\end{lstlisting}

\noindent S funcijo $quad\_vec(Q)$ pridobima vektorski del kvaterniona.

\begin{lstlisting}
function v = quat_vec(Q)
%input:
%Q              kvaternion (q0, q1, q2, q3)
%output:
%v              vektorski komponenta Q-ja, (q1, q2, q3)


v = [Q(2) Q(3) Q(4)];
end

\end{lstlisting}

\noindent S funcijo $quat\_rot\_mat$ oblikujeva rotacijsko matrako iz definicije \ref{definicijarotacije}:

\begin{lstlisting}
function H = quat_rot_mat(Q)
%input:
%Q          kvaternion
%
%output:
%H          rotacijska matrika za sfericno gibanje
%           (hi v zapiskih)

H = zeros(3,3);
h = sum(Q.^2);

if h == 0
    H = eye(3,3);
else
    H(1,1) = Q(1)^2+Q(2)^2 - Q(3)^2 - Q(4)^2;
    H(1,2) = 2*(Q(2)*Q(3) - Q(1)*Q(4));
    H(1,3) = 2*(Q(2)*Q(4) + Q(1)*Q(3));

    H(2,1) = 2*(Q(2)*Q(3) + Q(1)*Q(4));
    H(2,2) = Q(1)^2 - Q(2)^2 + Q(3)^2 - Q(4)^2;
    H(2,3) = 2*(Q(3)*Q(4) - Q(1)*Q(2));

    H(3,1) = 2*(Q(2)*Q(4) - Q(1)*Q(3));
    H(3,2) = 2*(Q(3)*Q(4) + Q(1)*Q(2));
    H(3,3) = Q(1)^2 - Q(2)^2 - Q(3)^2 + Q(4)^2;

    H = 1/h.*H;  
end

end
\end{lstlisting}

\begin{lstlisting}[caption = {For educational purposes}]
% example of while loop using placeholders
while "\ph{condition}"
  if "\ph{something-bad-happens}"
    break
  else
    % do something useful
  end
  % do more things
end
\end{lstlisting}

\end{document}
